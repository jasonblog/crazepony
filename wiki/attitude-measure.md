# {{page.title}}

## 陀螺儀
陀螺儀，測量角速度，具有高動態特性，但是它是一個間接測量角度的器件，它測量的是角度的導數，角速度，要將角速度對時間積分才能得到角度。

如果這個世界是理想的，美好的，那我們的問題到此就解決了，不過很遺憾，現實是殘酷的，誤差的引入，使得積分出現了問題。

假設陀螺儀固定不動，理想角速度值是0dps(degree per second)，但是有一個偏置0.1dps加在上面，於是測量出來是0.1dps，積分一秒之後，得到的角度是0.1度，1分鐘之後是6度，還能忍受，一小時之後是360度，轉了一圈，也就是說，陀螺儀在短時間內有很大的參考價值。

使用陀螺儀獲得角度，一定要考慮**積分誤差**的問題。

## 加速度計
加速度計可以測量加速度,包括重力加速度,於是在靜止或勻速運動的時候,加速度計僅僅測量的是重力加速度,而重力加速度與剛才所說的R座標系是固連的,通過這種關係,可以得到加速度計所在平面 與 地面 的角度關係.

但是加速度計若是繞著重力加速度的軸轉動,則測量值不會改變,也就是說無法感知這種水平旋轉。

## MPU6050姿態測量的兩種方法
MPU-60x0是9軸運動處理傳感器。它集成了3軸MEMS陀螺儀，3軸MEMS加速度計，以及一個可擴展的數字運動處理器DMP（Digital Motion Processor），可用I2C接口連接一個第三方的數字傳感器，比如磁力計。擴展之後就可以通過其I2C或SPI接口輸出一個9軸的信號。

MPU-60x0對陀螺儀和加速度計分別用了三個16位的ADC，將其測量的模擬量轉化為可輸出的數字量。在Crazepony-II上，測試了軟件解算四元數，然後通過四元數解算姿態角這種實現方式，其實總的來說，並沒感覺36MHz的主控壓力有多大，沒有出現機身不穩，卡死的情況。

![](/assets/img/mpu6050-quaternion.png)

同時，本著務實的態度，我們也測試了MPU6050的硬解四元數，即從IIC總線上讀到的數據不再是MPU60x0的AD值，而是通過初始化對DMP引擎的配置，從IIC總線上讀到的直接就是四元數的值，從而跳過了程序通過AD值計算四元數這個看起來繁瑣的步驟。測試結果是，機身反應的確要比之前反應靈活，最關鍵的一點是，這樣得出的偏航角（Yaw）很穩很穩，基本不會漂移或者說漂移小到了可以容忍的地步。

最後，MPU60x0的強大之處不僅於此，它支持一個從IIC接口，可以外部接上一個磁力計，如HMC5883，這樣一來，DMP引擎可以直接輸出一個絕對的方向姿態，即能夠輸出一個帶東西南北的姿態數據包，很厲害的樣子。在Crazepony-II第四版將會加上這樣一個磁力計，相信它再也不會迷路了~~ 

![](/assets/img/mpu6050-quaternion-dmp.png)
